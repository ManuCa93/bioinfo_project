---
title: "Bioinformatics Project - Bulk RNA-seq Differential Expression Analysis"
author: "Bidiscombe, Carnevale, Cattoni"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6)
```

# 1. Introduction and Biological Question

## Biological Context
Lung adenocarcinoma (LUAD) is the most common subtype of lung cancer and a leading cause of cancer-related deaths worldwide. Understanding the molecular changes that occur during tumorigenesis is crucial for identifying potential therapeutic targets and biomarkers.

## Computational Question
*What genes are differentially expressed between primary tumor tissue and adjacent normal tissue in lung adenocarcinoma patients?*

This analysis will help identify:
•⁠  ⁠Genes upregulated in tumors (potential oncogenes or tumor-promoting factors)
•⁠  ⁠Genes downregulated in tumors (potential tumor suppressors)
•⁠  ⁠Biological pathways disrupted in lung cancer

# 2. Data Loading and Preprocessing

```{r load_packages}
# Load required libraries
# Note: If any package is missing, install it first with:
# BiocManager::install(c("recount3", "DESeq2", "pheatmap", "org.Hs.eg.db"))

suppressPackageStartupMessages({
  library(recount3)
  library(SummarizedExperiment)
  library(DESeq2)
  library(ggplot2)
  library(pheatmap)
  library(dplyr)
  library(tibble)
})

cat("All packages loaded successfully!\n")
```

## 2.1 Download TCGA-LUAD Data from recount3

```{r load_data}
# List available projects
projects <- available_projects()

# Filter for TCGA projects
tcga_projects <- subset(projects, file_source == "tcga")

# Select LUAD (Lung Adenocarcinoma) project
projinfo_luad <- subset(tcga_projects, project == "LUAD")
print(projinfo_luad)

# Download the RangedSummarizedExperiment object
rse_gene <- create_rse(projinfo_luad)

# Extract count matrix and sample metadata
counts  <- assay(rse_gene, "raw_counts")
coldata <- colData(rse_gene)

cat("Dataset dimensions:", dim(counts)[1], "genes x", dim(counts)[2], "samples\n")
```

## 2.2 Filter for Tumor vs Normal Comparison

```{r filter_samples}
# Check available sample types
sample_type <- coldata$tcga.gdc_cases.samples.sample_type
cat("Available sample types:\n")
print(table(sample_type))

# Keep only Primary Tumor and Solid Tissue Normal
keep <- sample_type %in% c("Primary Tumor", "Solid Tissue Normal")
rse_gene_sub <- rse_gene[, keep]

counts_sub  <- assay(rse_gene_sub, "raw_counts")
coldata_sub <- as.data.frame(colData(rse_gene_sub))

cat("\nFiltered dataset:", dim(counts_sub)[1], "genes x", dim(counts_sub)[2], "samples\n")
cat("\nSample distribution:\n")
print(table(coldata_sub$tcga.gdc_cases.samples.sample_type))
```

## 2.3 Create Condition Variable

```{r create_condition}
# Create binary condition variable
condition <- ifelse(
  coldata_sub$tcga.gdc_cases.samples.sample_type == "Primary Tumor",
  "tumor",
  "normal"
)
coldata_sub$condition <- factor(condition, levels = c("normal", "tumor"))

cat("Final sample distribution:\n")
print(table(coldata_sub$condition))
```

## 2.4 Data Quality Control

```{r qc_filtering}
# Remove genes with very low counts (< 10 counts across all samples)
keep_genes <- rowSums(counts_sub) >= 10
counts_filtered <- counts_sub[keep_genes, ]

cat("Genes before filtering:", nrow(counts_sub), "\n")
cat("Genes after filtering:", nrow(counts_filtered), "\n")
cat("Genes removed:", nrow(counts_sub) - nrow(counts_filtered), "\n")
```

# 3. Differential Expression Analysis with DESeq2

## 3.1 Create DESeq2 Dataset

```{r create_deseq}
# Prepare sample metadata for DESeq2
sample_info <- data.frame(
  condition = coldata_sub$condition,
  row.names = colnames(counts_filtered)
)

# Create DESeqDataSet
dds <- DESeqDataSetFromMatrix(
  countData = counts_filtered,
  colData = sample_info,
  design = ~ condition
)

cat("DESeq2 dataset created with", nrow(dds), "genes and", ncol(dds), "samples\n")
```

## 3.2 Run DESeq2 Analysis

```{r run_deseq}
# Run differential expression analysis
dds <- DESeq(dds)

# Extract results (tumor vs normal, with normal as reference)
res <- results(dds, contrast = c("condition", "tumor", "normal"))

# Summary of results
cat("DESeq2 analysis summary:\n")
summary(res)
```

## 3.3 Process Results

```{r process_results}
# Convert to dataframe and add gene names
res_df <- as.data.frame(res)
res_df <- res_df %>%
  rownames_to_column("gene_id") %>%
  arrange(padj)

# Add significance labels
res_df <- res_df %>%
  mutate(
    significance = case_when(
      is.na(padj) ~ "Not tested",
      padj < 0.05 & abs(log2FoldChange) >= 1 ~ "Significant",
      TRUE ~ "Not significant"
    ),
    direction = case_when(
      padj < 0.05 & log2FoldChange >= 1 ~ "Upregulated",
      padj < 0.05 & log2FoldChange <= -1 ~ "Downregulated",
      TRUE ~ "Not significant"
    )
  )

# Summary statistics
cat("\nNumber of differentially expressed genes (padj < 0.05, |log2FC| >= 1):\n")
print(table(res_df$direction))

# Top 10 upregulated genes
cat("\n=== Top 10 Upregulated Genes in Tumors ===\n")
top_up <- res_df %>%
  filter(direction == "Upregulated") %>%
  arrange(desc(log2FoldChange)) %>%
  head(10)
print(top_up[, c("gene_id", "log2FoldChange", "padj")])

# Top 10 downregulated genes
cat("\n=== Top 10 Downregulated Genes in Tumors ===\n")
top_down <- res_df %>%
  filter(direction == "Downregulated") %>%
  arrange(log2FoldChange) %>%
  head(10)
print(top_down[, c("gene_id", "log2FoldChange", "padj")])
```


# 4. Visualization

## 4.1 MA Plot

```{r ma_plot}
# MA plot showing relationship between mean expression and log fold change
plotMA(res, ylim = c(-5, 5), alpha = 0.05, 
       main = "MA Plot: Tumor vs Normal",
       colNonSig = "gray70",
       colSig = "red3")
```

*Interpretation:* The MA plot shows the log2 fold changes (y-axis) versus the mean of normalized counts (x-axis). Red points indicate significantly differentially expressed genes (padj < 0.05). Genes with higher average expression tend to have more reliable fold change estimates.

## 4.2 Volcano Plot

```{r volcano_plot}
# Create volcano plot
ggplot(res_df, aes(x = log2FoldChange, y = -log10(padj))) +
  geom_point(aes(color = direction), alpha = 0.6, size = 1.5) +
  scale_color_manual(values = c("Upregulated" = "red", 
                                 "Downregulated" = "blue", 
                                 "Not significant" = "gray70")) +
  geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +
  geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "black") +
  labs(
    title = "Volcano Plot: Differential Expression in LUAD",
    subtitle = "Tumor vs Normal Tissue",
    x = "Log2 Fold Change",
    y = "-Log10 Adjusted P-value",
    color = "Regulation"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )
```

*Interpretation:* The volcano plot visualizes both statistical significance (y-axis) and biological significance (x-axis). Genes in the upper left and right corners are both statistically significant and show large expression changes. The dashed lines represent our thresholds (|log2FC| ≥ 1 and padj < 0.05).

## 4.3 Heatmap of Top Differentially Expressed Genes

```{r heatmap}
# Get top 50 differentially expressed genes
top_genes <- res_df %>%
  filter(significance == "Significant") %>%
  arrange(padj) %>%
  head(50) %>%
  pull(gene_id)

# Get normalized counts for these genes
vsd <- vst(dds, blind = FALSE)
mat <- assay(vsd)[top_genes, ]

# Prepare annotation for columns
annotation_col <- data.frame(
  Condition = coldata_sub$condition,
  row.names = colnames(mat)
)

# Create heatmap
pheatmap(
  mat,
  scale = "row",
  annotation_col = annotation_col,
  show_rownames = TRUE,
  show_colnames = FALSE,
  clustering_distance_rows = "euclidean",
  clustering_distance_cols = "euclidean",
  clustering_method = "complete",
  color = colorRampPalette(c("blue", "white", "red"))(100),
  main = "Top 50 Differentially Expressed Genes",
  fontsize_row = 6
)
```

*Interpretation:* This heatmap shows the expression patterns of the top 50 most significantly differentially expressed genes. Each row represents a gene, each column represents a sample. The samples clearly cluster by tissue type (tumor vs normal), indicating that these genes effectively distinguish between the two conditions.

## 4.4 PCA Plot

```{r pca_plot}
# Perform PCA
pcaData <- plotPCA(vsd, intgroup = "condition", returnData = TRUE)
percentVar <- round(100 * attr(pcaData, "percentVar"))

# Plot PCA
ggplot(pcaData, aes(x = PC1, y = PC2, color = condition)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("normal" = "forestgreen", "tumor" = "red3")) +
  labs(
    title = "PCA Plot: Sample Clustering",
    x = paste0("PC1: ", percentVar[1], "% variance"),
    y = paste0("PC2: ", percentVar[2], "% variance"),
    color = "Tissue Type"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```

*Interpretation:* Principal Component Analysis (PCA) reveals the overall structure of the data. PC1 clearly separates tumor from normal samples, capturing the largest source of variation in the dataset. This separation indicates strong transcriptional differences between tumor and normal tissue.

# 5. Biological Interpretation

## 5.1 Summary Statistics

```{r summary_stats}
cat("=== DIFFERENTIAL EXPRESSION SUMMARY ===\n\n")
cat("Total genes tested:", nrow(res_df %>% filter(!is.na(padj))), "\n")
cat("Significantly DE genes (padj < 0.05):", sum(res_df$padj < 0.05, na.rm = TRUE), "\n")
cat("Upregulated in tumor (|log2FC| >= 1):", sum(res_df$direction == "Upregulated", na.rm = TRUE), "\n")
cat("Downregulated in tumor (|log2FC| >= 1):", sum(res_df$direction == "Downregulated", na.rm = TRUE), "\n")
```

## 5.2 Biological Context of Key Findings

```{r biological_context}
# Load annotation library
if (!requireNamespace("org.Hs.eg.db", quietly = TRUE)) {
  BiocManager::install("org.Hs.eg.db")
}
library(org.Hs.eg.db)

# Convert Ensembl IDs to Entrez IDs and gene symbols
# Extract Ensembl ID without version number
res_df$ensembl_id_clean <- sub("\\..*", "", res_df$gene_id)

# Map to Entrez IDs and gene symbols
entrez_map <- mapIds(org.Hs.eg.db, 
                     keys = res_df$ensembl_id_clean,
                     column = "ENTREZID", 
                     keytype = "ENSEMBL",
                     multiVals = "first")

symbol_map <- mapIds(org.Hs.eg.db, 
                     keys = res_df$ensembl_id_clean,
                     column = "SYMBOL", 
                     keytype = "ENSEMBL",
                     multiVals = "first")

# Add to results dataframe
res_df$entrez_id <- entrez_map[res_df$ensembl_id_clean]
res_df$gene_symbol <- symbol_map[res_df$ensembl_id_clean]

# Reorder columns for better readability
res_df <- res_df %>%
  dplyr::select(gene_id, ensembl_id_clean, entrez_id, gene_symbol, 
         baseMean, log2FoldChange, lfcSE, stat, pvalue, padj, 
         significance, direction)

cat("\nAnnotation summary:\n")
cat("  - Total genes:", nrow(res_df), "\n")
cat("  - Genes with Entrez ID:", sum(!is.na(res_df$entrez_id)), "\n")
cat("  - Genes with gene symbol:", sum(!is.na(res_df$gene_symbol)), "\n")

# Export results for further analysis
write.csv(res_df, "results_de_genes_LUAD.csv", row.names = FALSE)
cat("\nResults exported to: results_de_genes_LUAD.csv\n")

# Save top DEGs for pathway analysis
top_degs <- res_df %>%
  filter(significance == "Significant") %>%
  arrange(padj)
write.csv(top_degs, "LUAD_significant_DEGs.csv", row.names = FALSE)
cat("Significant DEGs exported to: LUAD_significant_DEGs.csv\n")
```

# 6. Extended Results Analysis

## 6.1 Distribution of Differentially Expressed Genes

```{r deg_distribution}
# Detailed breakdown of DEG categories
cat("=== DIFFERENTIAL EXPRESSION BREAKDOWN ===\n\n")

# Overall statistics
total_tested <- sum(!is.na(res_df$padj))
total_sig <- sum(res_df$padj < 0.05, na.rm = TRUE)
total_sig_fc <- sum(res_df$significance == "Significant", na.rm = TRUE)

cat("Total genes tested:", total_tested, "\n")
cat("Significant genes (padj < 0.05):", total_sig, 
    sprintf("(%.1f%%)", 100 * total_sig / total_tested), "\n")
cat("Significant with |log2FC| >= 1:", total_sig_fc, 
    sprintf("(%.1f%%)", 100 * total_sig_fc / total_tested), "\n\n")

# Direction breakdown
cat("Direction of regulation:\n")
direction_table <- table(res_df$direction)
print(direction_table)
cat("\n")

# Proportion
cat("Proportion upregulated vs downregulated:\n")
up_genes <- sum(res_df$direction == "Upregulated", na.rm = TRUE)
down_genes <- sum(res_df$direction == "Downregulated", na.rm = TRUE)
cat(sprintf("Upregulated: %d (%.1f%%)\n", up_genes, 100 * up_genes / (up_genes + down_genes)))
cat(sprintf("Downregulated: %d (%.1f%%)\n", down_genes, 100 * down_genes / (up_genes + down_genes)))
```

## 6.2 Fold Change Distribution

```{r fc_distribution}
# Distribution of log2 fold changes for significant genes
sig_genes <- res_df %>% filter(significance == "Significant")

cat("\n=== LOG2 FOLD CHANGE STATISTICS (Significant DEGs) ===\n")
print(summary(sig_genes$log2FoldChange))

# Visualize fold change distribution
ggplot(sig_genes, aes(x = log2FoldChange, fill = direction)) +
  geom_histogram(bins = 50, alpha = 0.7, color = "black") +
  scale_fill_manual(values = c("Upregulated" = "red3", "Downregulated" = "blue3")) +
  geom_vline(xintercept = c(-1, 1), linetype = "dashed", size = 1) +
  labs(
    title = "Distribution of Log2 Fold Changes",
    subtitle = "Significant DEGs (padj < 0.05, |log2FC| >= 1)",
    x = "Log2 Fold Change",
    y = "Number of Genes",
    fill = "Direction"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5))
```

*Interpretation:* The distribution shows whether upregulated and downregulated genes have similar magnitude changes. A symmetric distribution suggests balanced regulation, while asymmetry might indicate preferential activation or repression of certain pathways.

## 6.3 Top Differentially Expressed Genes

```{r top_degs_analysis}
# Top 20 upregulated genes
cat("\n=== TOP 20 UPREGULATED GENES IN TUMORS ===\n")
top20_up <- res_df %>%
  filter(direction == "Upregulated") %>%
  arrange(desc(log2FoldChange)) %>%
  head(20) %>%
  mutate(
    log2FC = round(log2FoldChange, 2),
    padj_sci = format(padj, scientific = TRUE, digits = 3)
  ) %>%
  dplyr::select(gene_id, log2FC, padj_sci, baseMean)

print(top20_up)

# Top 20 downregulated genes
cat("\n=== TOP 20 DOWNREGULATED GENES IN TUMORS ===\n")
top20_down <- res_df %>%
  filter(direction == "Downregulated") %>%
  arrange(log2FoldChange) %>%
  head(20) %>%
  mutate(
    log2FC = round(log2FoldChange, 2),
    padj_sci = format(padj, scientific = TRUE, digits = 3)
  ) %>%
  dplyr::select(gene_id, log2FC, padj_sci, baseMean)

print(top20_down)
```

## 6.4 Most Statistically Significant Genes

```{r most_significant}
# Genes with lowest adjusted p-values
cat("\n=== TOP 20 MOST STATISTICALLY SIGNIFICANT GENES ===\n")
top20_sig <- res_df %>%
  filter(!is.na(padj)) %>%
  arrange(padj) %>%
  head(20) %>%
  mutate(
    log2FC = round(log2FoldChange, 2),
    padj_sci = format(padj, scientific = TRUE, digits = 3)
  ) %>%
  dplyr::select(gene_id, log2FC, padj_sci, direction, baseMean)

print(top20_sig)
```

## 6.5 Expression Level Analysis

```{r expression_levels}
# Relationship between expression level and differential expression
res_df_plot <- res_df %>%
  filter(!is.na(padj)) %>%
  mutate(
    expression_level = cut(baseMean, 
                          breaks = c(0, 10, 100, 1000, 10000, Inf),
                          labels = c("Very Low", "Low", "Medium", "High", "Very High"))
  )

# Count significant genes by expression level
sig_by_expr <- res_df_plot %>%
  group_by(expression_level) %>%
  summarise(
    total = n(),
    significant = sum(significance == "Significant"),
    percent_sig = round(100 * significant / total, 1)
  )

cat("\n=== DIFFERENTIAL EXPRESSION BY EXPRESSION LEVEL ===\n")
print(sig_by_expr)

# Visualize
ggplot(sig_by_expr, aes(x = expression_level, y = percent_sig, fill = expression_level)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = paste0(percent_sig, "%")), vjust = -0.5, size = 4) +
  scale_fill_brewer(palette = "YlOrRd") +
  labs(
    title = "Proportion of Significant DEGs by Expression Level",
    x = "Expression Level (baseMean)",
    y = "% Significantly Differentially Expressed",
    fill = "Expression Level"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "none"
  ) +
  ylim(0, max(sig_by_expr$percent_sig) * 1.1)
```

*Interpretation:* This analysis shows whether highly expressed genes or lowly expressed genes are more likely to be differentially expressed. Higher expression genes typically have more statistical power, but biological regulation can occur at any expression level.

## 6.6 Effect Size Analysis

```{r effect_size}
# Categorize genes by effect size
res_df_effect <- res_df %>%
  filter(significance == "Significant") %>%
  mutate(
    effect_size = case_when(
      abs(log2FoldChange) >= 3 ~ "Very Large (|log2FC| >= 3)",
      abs(log2FoldChange) >= 2 ~ "Large (2-3)",
      abs(log2FoldChange) >= 1 ~ "Moderate (1-2)",
      TRUE ~ "Small"
    ),
    effect_size = factor(effect_size, levels = c("Moderate (1-2)", "Large (2-3)", "Very Large (|log2FC| >= 3)"))
  )

# Count by effect size and direction
effect_summary <- res_df_effect %>%
  group_by(effect_size, direction) %>%
  summarise(count = n(), .groups = "drop")

cat("\n=== EFFECT SIZE DISTRIBUTION ===\n")
print(effect_summary)

# Visualize
ggplot(effect_summary, aes(x = effect_size, y = count, fill = direction)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  scale_fill_manual(values = c("Upregulated" = "red3", "Downregulated" = "blue3")) +
  labs(
    title = "Distribution of Effect Sizes Among DEGs",
    x = "Effect Size Category",
    y = "Number of Genes",
    fill = "Direction"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 0, hjust = 0.5)
  )
```

*Interpretation:* Effect size indicates the magnitude of change. Very large fold changes (|log2FC| >= 3 means 8-fold change) may represent key driver genes or highly dysregulated pathways, while moderate changes may reflect subtle regulatory adjustments.

## 6.7 P-value Distribution

```{r pvalue_distribution}
# Check p-value distribution (quality control)
ggplot(res_df %>% filter(!is.na(pvalue)), aes(x = pvalue)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Raw P-values",
    subtitle = "Uniform distribution with enrichment near 0 indicates good data quality",
    x = "Raw P-value",
    y = "Frequency"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 9)
  )
```

*Interpretation:* A proper p-value distribution should be relatively uniform across most values (representing null hypotheses) with an enrichment of small p-values near 0 (representing true positives). This pattern confirms our differential expression analysis is working correctly.

## 6.8 Comparison of Metrics

```{r metric_comparison}
# Scatter plot: log2FC vs -log10(padj) colored by expression
sig_for_plot <- res_df %>%
  filter(significance == "Significant") %>%
  mutate(log_expr = log10(baseMean + 1))

ggplot(sig_for_plot, aes(x = abs(log2FoldChange), y = -log10(padj), color = log_expr)) +
  geom_point(alpha = 0.6, size = 2) +
  scale_color_viridis_c(option = "plasma") +
  labs(
    title = "Relationship Between Effect Size and Statistical Significance",
    subtitle = "Significant DEGs only",
    x = "Absolute Log2 Fold Change",
    y = "-Log10(Adjusted P-value)",
    color = "Log10(Expression)"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

*Interpretation:* This plot shows that genes with higher expression levels (brighter colors) tend to achieve greater statistical significance for the same fold change, due to lower measurement variability. This is expected and demonstrates proper statistical behavior.

# 7. Biological Interpretation Summary

## 7.1 Key Quantitative Findings

```{r final_summary}
cat("\n")
cat("========================================\n")
cat("    FINAL ANALYSIS SUMMARY\n")
cat("========================================\n\n")

cat("DATASET:\n")
cat("  - Total genes analyzed:", nrow(res_df %>% filter(!is.na(padj))), "\n")
cat("  - Samples: Tumor (", sum(coldata_sub$condition == "tumor"), 
    ") vs Normal (", sum(coldata_sub$condition == "normal"), ")\n\n")

cat("DIFFERENTIAL EXPRESSION RESULTS:\n")
cat("  - Significant DEGs (padj < 0.05, |log2FC| >= 1):", 
    sum(res_df$significance == "Significant", na.rm = TRUE), "\n")
cat("  - Upregulated in tumor:", 
    sum(res_df$direction == "Upregulated", na.rm = TRUE), "\n")
cat("  - Downregulated in tumor:", 
    sum(res_df$direction == "Downregulated", na.rm = TRUE), "\n\n")

cat("EFFECT SIZES:\n")
effect_stats <- res_df %>% 
  filter(significance == "Significant") %>%
  summarise(
    min_fc = min(log2FoldChange),
    max_fc = max(log2FoldChange),
    median_fc = median(log2FoldChange)
  )
cat("  - Largest upregulation: log2FC =", round(effect_stats$max_fc, 2), 
    sprintf("(%.1f-fold)", 2^effect_stats$max_fc), "\n")
cat("  - Largest downregulation: log2FC =", round(effect_stats$min_fc, 2),
    sprintf("(%.1f-fold)", 2^effect_stats$min_fc), "\n")
cat("  - Median absolute log2FC:", round(median(abs(sig_genes$log2FoldChange)), 2), "\n\n")

cat("BIOLOGICAL SIGNIFICANCE:\n")
cat("  - ", round(100 * sum(res_df$significance == "Significant", na.rm = TRUE) / total_tested, 1),
    "% of genes are differentially expressed\n", sep = "")
cat("  - This indicates extensive transcriptional reprogramming\n")
cat("  - Consistent with hallmarks of cancer (proliferation, evasion, metabolism)\n\n")

cat("========================================\n")
```

## 7.2 Biological Context

The extensive differential expression observed (>16,000 genes) reflects the complex molecular changes during lung adenocarcinoma development:

*Expected Biological Processes Affected:*

1.⁠ ⁠*Cell Cycle & Proliferation*: Upregulated genes likely include cyclins, CDKs, and DNA replication machinery
2.⁠ ⁠*Apoptosis Evasion*: Downregulation of pro-apoptotic genes, upregulation of anti-apoptotic factors
3.⁠ ⁠*Metabolic Reprogramming*: Enhanced glycolysis (Warburg effect) and altered mitochondrial function
4.⁠ ⁠*Immune Evasion*: Changes in immune checkpoint genes and antigen presentation
5.⁠ ⁠*ECM Remodeling*: Matrix metalloproteinases and adhesion molecules for invasion/metastasis
6.⁠ ⁠*Angiogenesis*: VEGF and related factors to support tumor vasculature

*Clinical Relevance:*

•⁠  ⁠Identified DEGs may include known therapeutic targets (e.g., EGFR, ALK)
•⁠  ⁠Novel biomarkers for diagnosis, prognosis, or treatment selection
•⁠  ⁠Basis for understanding resistance mechanisms

# 8. Conclusions

## Key Findings:

1. **Massive Transcriptional Changes**: We identified 16,342 significantly differentially expressed genes (28% of tested genes) between tumor and normal lung tissue, indicating substantial molecular reprogramming during tumorigenesis.

2. **Clear Tissue Separation**: PCA and hierarchical clustering show that tumor and normal samples form distinct groups based on gene expression, validating the quality of our analysis.

3. **Balanced Regulation**: Both upregulated and downregulated genes are present, suggesting coordinated activation of oncogenic programs and silencing of tumor suppressors.

4. **Range of Effect Sizes**: Fold changes span from moderate (2-fold) to extreme (>100-fold), indicating both subtle regulatory changes and dramatic pathway disruptions.

5. **Methodological Strengths**:
   - Used established TCGA data (standardized, high-quality)
   - Applied DESeq2 (gold standard for RNA-seq differential expression)
   - Multiple testing correction (FDR control via Benjamini-Hochberg)
   - Stringent thresholds (padj < 0.05 and |log2FC| ≥ 1)

## Study Limitations:

- Bulk RNA-seq cannot distinguish cell-type specific changes
- Cross-sectional design limits causal inference
- Need validation in independent cohorts
- Functional validation required to confirm biological relevance

## Future Directions:

- **Pathway Enrichment Analysis**: Identify enriched biological processes and pathways
- **Gene Set Analysis**: Test for coordinated changes in cancer-related gene sets
- **Clinical Correlation**: Relate DEGs to patient outcomes and tumor stage
- **Validation**: qRT-PCR or independent datasets
- **Functional Studies**: Experimental validation of key candidates

---