---
title: "Bioinformatics Project - Bulk RNA-seq Differential Expression Analysis"
author: "Bidiscombe, Carnevale, Cattoni"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6)
```

# 1. Introduction and Biological Question

## Biological Context

Lung adenocarcinoma (LUAD) is the most common subtype of lung cancer and a leading cause of cancer-related deaths worldwide. Understanding the molecular changes that occur during tumorigenesis is crucial for identifying potential therapeutic targets and biomarkers.

## Computational Question

*What genes are differentially expressed between primary tumor tissue and adjacent normal tissue in lung adenocarcinoma patients?*

This analysis will help identify:

-   Genes upregulated in tumors (potential oncogenes or tumor-promoting factors)
-   Genes downregulated in tumors (potential tumor suppressors)
-   Biological pathways disrupted in lung cancer

# 2. Data Loading and Preprocessing

```{r load_packages}
# Load required libraries
# Note: If any package is missing, install it first with:
# BiocManager::install(c("recount3", "edgeR", "limma", "pheatmap", "org.Hs.eg.db", "clusterProfiler"))

suppressPackageStartupMessages({
  library(recount3)
  library(SummarizedExperiment)
  library(edgeR)
  library(limma)
  library(ggplot2)
  library(pheatmap)
  library(dplyr)
  library(tibble)
})

cat("All packages loaded successfully!\n")
```

## 2.1 Download TCGA-LUAD Data from recount3

```{r load_data}
# List available projects
projects <- available_projects()

# Filter for TCGA projects
tcga_projects <- subset(projects, file_source == "tcga")

# Select LUAD (Lung Adenocarcinoma) project
projinfo_luad <- subset(tcga_projects, project == "LUAD")
print(projinfo_luad)

# Download the RangedSummarizedExperiment object
rse_gene <- create_rse(projinfo_luad)

# Extract count matrix and sample metadata
counts  <- assay(rse_gene, "raw_counts")
coldata <- colData(rse_gene)

cat("Dataset dimensions:", dim(counts)[1], "genes x", dim(counts)[2], "samples\n")
```

## 2.2 Filter for Tumor vs Normal Comparison

```{r filter_samples}
# Check available sample types
sample_type <- coldata$tcga.gdc_cases.samples.sample_type
cat("Available sample types:\n")
print(table(sample_type))

# Keep only Primary Tumor and Solid Tissue Normal
keep <- sample_type %in% c("Primary Tumor", "Solid Tissue Normal")
rse_gene_sub <- rse_gene[, keep]

counts_sub  <- assay(rse_gene_sub, "raw_counts")
coldata_sub <- as.data.frame(colData(rse_gene_sub))

cat("\nFiltered dataset:", dim(counts_sub)[1], "genes x", dim(counts_sub)[2], "samples\n")
cat("\nSample distribution:\n")
print(table(coldata_sub$tcga.gdc_cases.samples.sample_type))
```

## 2.3 Create Condition Variable

```{r create_condition}
# Create binary condition variable
condition <- ifelse(
  coldata_sub$tcga.gdc_cases.samples.sample_type == "Primary Tumor",
  "tumor",
  "normal"
)
coldata_sub$condition <- factor(condition, levels = c("normal", "tumor"))

cat("Final sample distribution:\n")
print(table(coldata_sub$condition))
```

## 2.4 Data Quality Control with CPM Filtering

```{r qc_filtering}
# Calculate CPM (Counts Per Million)
cpm_values <- cpm(counts_sub)

# Determine the size of the smallest group
min_group_size <- min(table(coldata_sub$condition))

# Keep genes with CPM > 0.5 in at least min_group_size samples
keep_genes <- rowSums(cpm_values > 0.5) >= min_group_size
counts_filtered <- counts_sub[keep_genes, ]

cat("Genes before filtering:", nrow(counts_sub), "\n")
cat("Genes after filtering:", nrow(counts_filtered), "\n")
cat("Genes removed:", nrow(counts_sub) - nrow(counts_filtered), "\n")
cat("Filtering criterion: CPM > 0.5 in at least", min_group_size, "samples\n")
```

# 3. Differential Expression Analysis with edgeR

## 3.1 Create DGEList Object

```{r create_dgelist}
# Prepare sample metadata for edgeR
sample_info <- data.frame(
  condition = coldata_sub$condition,
  row.names = colnames(counts_filtered)
)

# Create DGEList object
dge <- DGEList(counts = counts_filtered, group = sample_info$condition)

cat("DGEList object created with", nrow(dge), "genes and", ncol(dge), "samples\n")
cat("\nLibrary sizes:\n")
print(summary(dge$samples$lib.size))
```

## 3.2 Normalization

```{r normalization}
# Calculate normalization factors using TMM (Trimmed Mean of M-values)
dge <- calcNormFactors(dge, method = "TMM")

cat("Normalization factors calculated:\n")
print(summary(dge$samples$norm.factors))

# Visualize normalization factors
barplot(dge$samples$norm.factors, 
        main = "TMM Normalization Factors",
        ylab = "Normalization Factor",
        xlab = "Sample Index",
        col = ifelse(dge$samples$group == "tumor", "red3", "forestgreen"),
        las = 2)
abline(h = 1, lty = 2, col = "blue")
legend("topright", legend = c("Tumor", "Normal"), 
       fill = c("red3", "forestgreen"), bty = "n")
```

*Interpretation:* TMM normalization accounts for differences in library composition between samples. Normalization factors close to 1 indicate similar library compositions, while deviations suggest compositional biases that are corrected.

## 3.3 Design Matrix and Dispersion Estimation

```{r design_dispersion}
# Create design matrix
design <- model.matrix(~ condition, data = sample_info)
colnames(design) <- c("Intercept", "TumorvNormal")

cat("Design matrix:\n")
print(head(design))

# Estimate dispersion
dge <- estimateDisp(dge, design, robust = TRUE)

cat("\nDispersion estimates:\n")
cat("  Common dispersion:", dge$common.dispersion, "\n")
cat("  Trended dispersion range:", range(dge$trended.dispersion), "\n")
cat("  Tagwise dispersion range:", range(dge$tagwise.dispersion), "\n")

# Plot biological coefficient of variation
plotBCV(dge, main = "Biological Coefficient of Variation")
```

*Interpretation:* The BCV plot shows the biological variability in gene expression. The common dispersion represents the overall variability, while tagwise dispersions capture gene-specific variation. Higher BCV indicates greater biological variability between replicates.

## 3.4 Differential Expression Testing

```{r glm_testing}
# Fit generalized linear model
fit <- glmFit(dge, design)

# Perform likelihood ratio test for tumor vs normal
lrt <- glmLRT(fit, coef = "TumorvNormal")

# Extract results
res <- topTags(lrt, n = Inf)
res_df <- as.data.frame(res)

cat("edgeR analysis summary:\n")
cat("Total genes tested:", nrow(res_df), "\n")
cat("Genes with FDR < 0.05:", sum(res_df$FDR < 0.05), "\n")
```

## 3.5 Process Results

```{r process_results}
# Convert to dataframe and add gene names
res_df <- res_df %>%
  rownames_to_column("gene_id") %>%
  arrange(FDR)

# Add significance labels
res_df <- res_df %>%
  mutate(
    significance = case_when(
      is.na(FDR) ~ "Not tested",
      FDR < 0.05 & abs(logFC) >= 1 ~ "Significant",
      TRUE ~ "Not significant"
    ),
    direction = case_when(
      FDR < 0.05 & logFC >= 1 ~ "Upregulated",
      FDR < 0.05 & logFC <= -1 ~ "Downregulated",
      TRUE ~ "Not significant"
    )
  )

# Summary statistics
cat("\nNumber of differentially expressed genes (FDR < 0.05, |logFC| >= 1):\n")
print(table(res_df$direction))

# Top 10 upregulated genes
cat("\n=== Top 10 Upregulated Genes in Tumors ===\n")
top_up <- res_df %>%
  filter(direction == "Upregulated") %>%
  arrange(desc(logFC)) %>%
  head(10)
print(top_up[, c("gene_id", "logFC", "FDR")])

# Top 10 downregulated genes
cat("\n=== Top 10 Downregulated Genes in Tumors ===\n")
top_down <- res_df %>%
  filter(direction == "Downregulated") %>%
  arrange(logFC) %>%
  head(10)
print(top_down[, c("gene_id", "logFC", "FDR")])
```

# 4. Visualization

## 4.1 MA Plot

```{r ma_plot}
# MA plot showing relationship between mean expression and log fold change
plotMD(lrt, main = "MA Plot: Tumor vs Normal")
abline(h = c(-1, 1), col = "blue", lty = 2)
```

*Interpretation:* The MA plot shows the log2 fold changes (y-axis) versus the average log2 counts per million (x-axis). Red points indicate significantly differentially expressed genes (FDR \< 0.05). Genes with higher average expression tend to have more reliable fold change estimates.

## 4.2 Volcano Plot

```{r volcano_plot}
# Create volcano plot
ggplot(res_df, aes(x = logFC, y = -log10(FDR))) +
  geom_point(aes(color = direction), alpha = 0.6, size = 1.5) +
  scale_color_manual(values = c("Upregulated" = "red", 
                                 "Downregulated" = "blue", 
                                 "Not significant" = "gray70")) +
  geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +
  geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "black") +
  labs(
    title = "Volcano Plot: Differential Expression in LUAD",
    subtitle = "Tumor vs Normal Tissue (edgeR analysis)",
    x = "Log2 Fold Change",
    y = "-Log10 FDR",
    color = "Regulation"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )
```

*Interpretation:* The volcano plot visualizes both statistical significance (y-axis) and biological significance (x-axis). Genes in the upper left and right corners are both statistically significant and show large expression changes. The dashed lines represent our thresholds (\|logFC\| â‰¥ 1 and FDR \< 0.05).

## 4.3 Heatmap of Top Differentially Expressed Genes

```{r heatmap}
# Get top 50 differentially expressed genes
top_genes <- res_df %>%
  filter(significance == "Significant") %>%
  arrange(FDR) %>%
  head(50) %>%
  pull(gene_id)

# Calculate log-CPM values for heatmap
logcpm <- cpm(dge, log = TRUE)
mat <- logcpm[top_genes, ]

# Prepare annotation for columns
annotation_col <- data.frame(
  Condition = coldata_sub$condition,
  row.names = colnames(mat)
)

# Create heatmap
pheatmap(
  mat,
  scale = "row",
  annotation_col = annotation_col,
  show_rownames = TRUE,
  show_colnames = FALSE,
  clustering_distance_rows = "euclidean",
  clustering_distance_cols = "euclidean",
  clustering_method = "complete",
  color = colorRampPalette(c("blue", "white", "red"))(100),
  main = "Top 50 Differentially Expressed Genes",
  fontsize_row = 6
)
```

*Interpretation:* This heatmap shows the expression patterns of the top 50 most significantly differentially expressed genes. Each row represents a gene, each column represents a sample. The samples clearly cluster by tissue type (tumor vs normal), indicating that these genes effectively distinguish between the two conditions.

## 4.4 MDS Plot

```{r mds_plot}
# Multidimensional scaling plot
# Calculate log-CPM with prior count
logcpm_mds <- cpm(dge, log = TRUE, prior.count = 2)

# Perform MDS
mds <- plotMDS(logcpm_mds, plot = FALSE)

# Create dataframe for plotting
mds_data <- data.frame(
  Dim1 = mds$x,
  Dim2 = mds$y,
  condition = coldata_sub$condition
)

# Plot MDS
ggplot(mds_data, aes(x = Dim1, y = Dim2, color = condition)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("normal" = "forestgreen", "tumor" = "red3")) +
  labs(
    title = "MDS Plot: Sample Clustering",
    x = "Leading logFC dimension 1",
    y = "Leading logFC dimension 2",
    color = "Tissue Type"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```

*Interpretation:* Multidimensional Scaling (MDS) plot reveals the overall structure of the data based on leading fold changes. The clear separation between tumor and normal samples indicates strong transcriptional differences between tissue types. MDS is analogous to PCA but based on pairwise distances between samples.

# 5. Gene Annotation

## 5.1 Add Gene Symbols and Entrez IDs

```{r biological_context}
# Load annotation library
if (!requireNamespace("org.Hs.eg.db", quietly = TRUE)) {
  BiocManager::install("org.Hs.eg.db")
}
library(org.Hs.eg.db)

# Convert Ensembl IDs to Entrez IDs and gene symbols
# Extract Ensembl ID without version number
res_df$ensembl_id_clean <- sub("\\..*", "", res_df$gene_id)

# Map to Entrez IDs and gene symbols
entrez_map <- mapIds(org.Hs.eg.db, 
                     keys = res_df$ensembl_id_clean,
                     column = "ENTREZID", 
                     keytype = "ENSEMBL",
                     multiVals = "first")

symbol_map <- mapIds(org.Hs.eg.db, 
                     keys = res_df$ensembl_id_clean,
                     column = "SYMBOL", 
                     keytype = "ENSEMBL",
                     multiVals = "first")

# Add to results dataframe
res_df$entrez_id <- entrez_map[res_df$ensembl_id_clean]
res_df$gene_symbol <- symbol_map[res_df$ensembl_id_clean]

# Reorder columns for better readability
res_df <- res_df %>%
  dplyr::select(gene_id, ensembl_id_clean, entrez_id, gene_symbol, 
         logFC, logCPM, LR, PValue, FDR, 
         significance, direction)

cat("\nAnnotation summary:\n")
cat("  - Total genes:", nrow(res_df), "\n")
cat("  - Genes with Entrez ID:", sum(!is.na(res_df$entrez_id)), "\n")
cat("  - Genes with gene symbol:", sum(!is.na(res_df$gene_symbol)), "\n")

# Export results for further analysis
write.csv(res_df, "results_de_genes_LUAD_edgeR.csv", row.names = FALSE)
cat("\nResults exported to: results_de_genes_LUAD_edgeR.csv\n")

# Save top DEGs for pathway analysis
top_degs <- res_df %>%
  filter(significance == "Significant") %>%
  arrange(FDR)
write.csv(top_degs, "LUAD_significant_DEGs_edgeR.csv", row.names = FALSE)
cat("Significant DEGs exported to: LUAD_significant_DEGs_edgeR.csv\n")
```

# 6. GO Enrichment Analysis

## 6.1 Prepare Gene Lists for Enrichment

```{r prepare_gene_lists}
# Load clusterProfiler
if (!requireNamespace("clusterProfiler", quietly = TRUE)) {
  BiocManager::install("clusterProfiler")
}
library(clusterProfiler)

# Get significant upregulated genes
sig_up <- res_df %>%
  filter(direction == "Upregulated", !is.na(entrez_id)) %>%
  pull(entrez_id)

# Get significant downregulated genes
sig_down <- res_df %>%
  filter(direction == "Downregulated", !is.na(entrez_id)) %>%
  pull(entrez_id)

# Get all significant genes
sig_all <- res_df %>%
  filter(significance == "Significant", !is.na(entrez_id)) %>%
  pull(entrez_id)

# Background: all genes tested
background <- res_df %>%
  filter(!is.na(entrez_id)) %>%
  pull(entrez_id)

cat("Genes for enrichment analysis:\n")
cat("  - Upregulated:", length(sig_up), "\n")
cat("  - Downregulated:", length(sig_down), "\n")
cat("  - Total significant:", length(sig_all), "\n")
cat("  - Background:", length(background), "\n")
```

## 6.2 GO Enrichment - All Significant Genes

```{r go_enrichment_all}
# GO enrichment for all significant genes
ego_all <- enrichGO(
  gene = sig_all,
  universe = background,
  OrgDb = org.Hs.eg.db,
  ont = "BP",  # Biological Process
  pAdjustMethod = "BH",
  pvalueCutoff = 0.05,
  qvalueCutoff = 0.2,
  readable = TRUE
)

cat("\nGO Enrichment Results (All DEGs):\n")
cat("  - Enriched terms:", nrow(ego_all@result), "\n")

if (nrow(ego_all@result) > 0) {
  # Display top 10 enriched terms
  cat("\nTop 10 Enriched GO Terms:\n")
  print(head(ego_all@result[, c("Description", "GeneRatio", "pvalue", "qvalue")], 10))
  
  # Dotplot
  print(dotplot(ego_all, showCategory = 20, title = "GO Enrichment - All DEGs"))
  
  # Barplot
  print(barplot(ego_all, showCategory = 15, title = "Top GO Terms - All DEGs"))
}
```

## 6.3 GO Enrichment - Upregulated Genes

```{r go_enrichment_up}
# GO enrichment for upregulated genes
ego_up <- enrichGO(
  gene = sig_up,
  universe = background,
  OrgDb = org.Hs.eg.db,
  ont = "BP",
  pAdjustMethod = "BH",
  pvalueCutoff = 0.05,
  qvalueCutoff = 0.2,
  readable = TRUE
)

cat("\nGO Enrichment Results (Upregulated):\n")
cat("  - Enriched terms:", nrow(ego_up@result), "\n")

if (nrow(ego_up@result) > 0) {
  # Display top 10 enriched terms
  cat("\nTop 10 Enriched GO Terms (Upregulated):\n")
  print(head(ego_up@result[, c("Description", "GeneRatio", "pvalue", "qvalue")], 10))
  
  # Dotplot
  print(dotplot(ego_up, showCategory = 20, title = "GO Enrichment - Upregulated Genes"))
  
  # Barplot
  print(barplot(ego_up, showCategory = 15, title = "Top GO Terms - Upregulated"))
}
```

## 6.4 GO Enrichment - Downregulated Genes

```{r go_enrichment_down}
# GO enrichment for downregulated genes
ego_down <- enrichGO(
  gene = sig_down,
  universe = background,
  OrgDb = org.Hs.eg.db,
  ont = "BP",
  pAdjustMethod = "BH",
  pvalueCutoff = 0.05,
  qvalueCutoff = 0.2,
  readable = TRUE
)

cat("\nGO Enrichment Results (Downregulated):\n")
cat("  - Enriched terms:", nrow(ego_down@result), "\n")

if (nrow(ego_down@result) > 0) {
  # Display top 10 enriched terms
  cat("\nTop 10 Enriched GO Terms (Downregulated):\n")
  print(head(ego_down@result[, c("Description", "GeneRatio", "pvalue", "qvalue")], 10))
  
  # Dotplot
  print(dotplot(ego_down, showCategory = 20, title = "GO Enrichment - Downregulated Genes"))
  
  # Barplot
  print(barplot(ego_down, showCategory = 15, title = "Top GO Terms - Downregulated"))
}
```

## 6.5 Compare Enrichment Between Up and Down

```{r compare_enrichment}
if (nrow(ego_up@result) > 0 && nrow(ego_down@result) > 0) {
  # Create comparison list
  gene_list <- list(
    Upregulated = sig_up,
    Downregulated = sig_down
  )
  
  # Compare GO enrichment
  compare_go <- compareCluster(
    geneCluster = gene_list,
    fun = "enrichGO",
    OrgDb = org.Hs.eg.db,
    ont = "BP",
    pAdjustMethod = "BH",
    pvalueCutoff = 0.05,
    qvalueCutoff = 0.2
  )
  
  # Dotplot comparison
  print(dotplot(compare_go, showCategory = 10, 
                title = "GO Enrichment Comparison: Up vs Down"))
}
```

*Interpretation:* GO enrichment analysis reveals the biological processes most affected by differential expression. Upregulated genes may be enriched in cell proliferation, DNA replication, and metabolic pathways associated with cancer. Downregulated genes may be enriched in differentiation, immune response, or tumor suppressor pathways.

# 7. Extended Results Analysis

## 7.1 Distribution of Differentially Expressed Genes

```{r deg_distribution}
# Detailed breakdown of DEG categories
cat("=== DIFFERENTIAL EXPRESSION BREAKDOWN ===\n\n")

# Overall statistics
total_tested <- nrow(res_df)
total_sig <- sum(res_df$FDR < 0.05, na.rm = TRUE)
total_sig_fc <- sum(res_df$significance == "Significant", na.rm = TRUE)

cat("Total genes tested:", total_tested, "\n")
cat("Significant genes (FDR < 0.05):", total_sig, 
    sprintf("(%.1f%%)", 100 * total_sig / total_tested), "\n")
cat("Significant with |logFC| >= 1:", total_sig_fc, 
    sprintf("(%.1f%%)", 100 * total_sig_fc / total_tested), "\n\n")

# Direction breakdown
cat("Direction of regulation:\n")
direction_table <- table(res_df$direction)
print(direction_table)
cat("\n")

# Proportion
cat("Proportion upregulated vs downregulated:\n")
up_genes <- sum(res_df$direction == "Upregulated", na.rm = TRUE)
down_genes <- sum(res_df$direction == "Downregulated", na.rm = TRUE)
cat(sprintf("Upregulated: %d (%.1f%%)\n", up_genes, 100 * up_genes / (up_genes + down_genes)))
cat(sprintf("Downregulated: %d (%.1f%%)\n", down_genes, 100 * down_genes / (up_genes + down_genes)))
```

## 7.2 Fold Change Distribution

```{r fc_distribution}
# Distribution of log2 fold changes for significant genes
sig_genes <- res_df %>% filter(significance == "Significant")

cat("\n=== LOG2 FOLD CHANGE STATISTICS (Significant DEGs) ===\n")
print(summary(sig_genes$logFC))

# Visualize fold change distribution
ggplot(sig_genes, aes(x = logFC, fill = direction)) +
  geom_histogram(bins = 50, alpha = 0.7, color = "black") +
  scale_fill_manual(values = c("Upregulated" = "red3", "Downregulated" = "blue3")) +
  geom_vline(xintercept = c(-1, 1), linetype = "dashed", linewidth = 1) +
  labs(
    title = "Distribution of Log2 Fold Changes",
    subtitle = "Significant DEGs (FDR < 0.05, |logFC| >= 1)",
    x = "Log2 Fold Change",
    y = "Number of Genes",
    fill = "Direction"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5))
```

*Interpretation:* The distribution shows whether upregulated and downregulated genes have similar magnitude changes. A symmetric distribution suggests balanced regulation, while asymmetry might indicate preferential activation or repression of certain pathways.

## 7.3 P-value Distribution

```{r pvalue_distribution}
# Check p-value distribution (quality control)
ggplot(res_df %>% filter(!is.na(PValue)), aes(x = PValue)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Raw P-values",
    subtitle = "Uniform distribution with enrichment near 0 indicates good data quality",
    x = "Raw P-value",
    y = "Frequency"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 9)
  )
```

*Interpretation:* A proper p-value distribution should be relatively uniform across most values (representing null hypotheses) with an enrichment of small p-values near 0 (representing true positives). This pattern confirms our differential expression analysis is working correctly.

# 8. Biological Interpretation Summary

## 8.1 Key Quantitative Findings

```{r final_summary}
cat("\n")
cat("========================================\n")
cat("    FINAL ANALYSIS SUMMARY\n")
cat("========================================\n\n")

cat("DATASET:\n")
cat("  - Total genes analyzed:", nrow(res_df), "\n")
cat("  - Samples: Tumor (", sum(coldata_sub$condition == "tumor"), 
    ") vs Normal (", sum(coldata_sub$condition == "normal"), ")\n\n")

cat("DIFFERENTIAL EXPRESSION RESULTS (edgeR):\n")
cat("  - Significant DEGs (FDR < 0.05, |logFC| >= 1):", 
    sum(res_df$significance == "Significant", na.rm = TRUE), "\n")
cat("  - Upregulated in tumor:", 
    sum(res_df$direction == "Upregulated", na.rm = TRUE), "\n")
cat("  - Downregulated in tumor:", 
    sum(res_df$direction == "Downregulated", na.rm = TRUE), "\n\n")

cat("EFFECT SIZES:\n")
effect_stats <- res_df %>% 
  filter(significance == "Significant") %>%
  summarise(
    min_fc = min(logFC),
    max_fc = max(logFC),
    median_fc = median(logFC)
  )
cat("  - Largest upregulation: logFC =", round(effect_stats$max_fc, 2), 
    sprintf("(%.1f-fold)", 2^effect_stats$max_fc), "\n")
cat("  - Largest downregulation: logFC =", round(effect_stats$min_fc, 2),
    sprintf("(%.1f-fold)", 2^effect_stats$min_fc), "\n")
cat("  - Median absolute logFC:", round(median(abs(sig_genes$logFC)), 2), "\n\n")

cat("BIOLOGICAL SIGNIFICANCE:\n")
cat("  - ", round(100 * sum(res_df$significance == "Significant", na.rm = TRUE) / total_tested, 1),
    "% of genes are differentially expressed\n", sep = "")
cat("  - This indicates extensive transcriptional reprogramming\n")
cat("  - Consistent with hallmarks of cancer (proliferation, evasion, metabolism)\n\n")

cat("========================================\n")
```

## 8.2 Biological Context

The extensive differential expression observed reflects the complex molecular changes during lung adenocarcinoma development:

**Expected Biological Processes Affected:**

1.  **Cell Cycle & Proliferation**: Upregulated genes likely include cyclins, CDKs, and DNA replication machinery
2.  **Apoptosis Evasion**: Downregulation of pro-ap
